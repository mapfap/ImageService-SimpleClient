<!DOCTYPE html>

<html lang="en">
<head>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <script src="jquery-1.11.0.min.js"></script>
  <script src="bootstrap.min.js"></script>

<form method='post' enctype="multipart/form-data">
  <button type="submit" class="btn btn-file btn-success">
    <span class="glyphicon glyphicon-file">
      <input id="file" type='file' name='file' />
    </span>
  </button>
</form>

<br>
Request
<input type="text" class="url">

</input>
<button id="get">
  GET
</button>

<div class="show">

</div>

<script>
  $(function() {

    $("#get").click(function(e) {
      $(".show").html("<img src='" + $(".url").val() + "'>");
    });

    function postFile() {
      var formData = new FormData($('form')[0]);
      $.ajax({
        url: "http://localhost:8080/images",  //Server script to process data
        type: "POST",
        xhr: function() {  // Custom XMLHttpRequest
            var myXhr = $.ajaxSettings.xhr();
            if (myXhr.upload) { // Check if upload property exists
                // myXhr.upload.addEventListener("progress", progressHandlingFunction, false); // For handling the progress of the upload
            }
            return myXhr;
        },
        //Ajax events
        beforeSend: function(res) { 
          // console.log(res)
        },
        success: function(data, textStatus, jqXHR) {
          // console.log(res.getResponseHeader("location"));
          var location = jqXHR.getResponseHeader("location");
          $(".url").val(location);
          $(".show").html("<img src='" + location + "'>");

        },
        error: function(data, textStatus, jqXHR) {
          console.log(textStatus)
        },
        // Form data
        data: formData,
        //Options to tell jQuery not to process data or worry about content-type.
        cache: false,
        contentType: false,
        processData: false
    });
    }

    $("#file").change(function () {
      if ($("#file").val() == "") {
        return;
      }

      postFile();

      $("#file").val("");
    });
  });
</script>
<style>

  .url {
    width: 800px;
  }

  .btn-file {
      position: relative;
      overflow: hidden;
  }

  #file {
      position: absolute;
      top: 0;
      right: 0;
      min-width: 100%;
      min-height: 100%;
      font-size: 100px;
      text-align: right;
      filter: alpha(opacity=0);
      opacity: 0;
      outline: none;
      background: white;
      cursor: inherit;
      display: block;
  }
</style>